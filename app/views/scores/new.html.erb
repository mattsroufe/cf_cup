<div style="text-align: center; position: absolute; width: 100%; top: 0px"><p style="color: green; "><%= notice %></p></div>

<h4 style="text-align:center; margin: 0"><%= @match.course.name %></h4>
<div style="display:flex; justify-content:center">
  <h2 class="logo" style="margin-bottom:0">No. <%= @hole.number %></h2>
</div>
<div style="display:flex; justify-content:space-evenly">
<span>Par: <%= @hole.par %></span>
<span>Stroke: <%= @hole.stroke %></span>
</div>

<% @players.each do |player| %>
  <%= render "form", player: player, score: player.scores.find_or_create_by(match_id: @match.id, hole_id: @hole.id) %>
<% end %>

<br>

<div style="text-align:center; margin-bottom:32px">
  <%= link_to "Back to scorecard", scores_path(match_id: @match.id) %>
</div>

<script>
  function debounce(func, wait, immediate) {
    var timeout;
    return function() {
      var context = this, args = arguments;
      var later = function() {
        timeout = null;
        if (!immediate) func.apply(context, args);
      };
      var callNow = immediate && !timeout;
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
      if (callNow) func.apply(context, args);
    };
  };
  var emitChangeEvent = debounce(function (input) {
    input.dispatchEvent(new Event('change'))
  }, 300)

  document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', e => {
      const body = new FormData(form)
      fetch(form.action, {
        method: form.method, // or 'PUT'
        body: body,
      })
      e.preventDefault()
    })
    form.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', e => {
        form.dispatchEvent(new Event('submit'));
      });
    })
    form.querySelector('input[type="number"]').addEventListener('change', e => {
      form.dispatchEvent(new Event('submit'));
    })
    form.querySelectorAll('[data-target]').forEach(button => {
      button.addEventListener('click', e => {
        const input = form.querySelector(`#${button.dataset.target}`);
        if (input.value.length > 0) {
          input.value = button.querySelector('use').getAttribute('xlink:href').split('-').splice(-1)[0] === 'plus' ? parseInt(input.value) + 1 : parseInt(input.value) - 1
        } else {
          input.value = input.dataset.par
        }
        emitChangeEvent(input)
        e.preventDefault()
      })
    })
  })
</script>